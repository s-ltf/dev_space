<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
</head>

<body>
  
  <p>
  <form id="incomingMsg">
  <input type="text" name="display" size="30" value="Incoming Msg" readonly="readonly">
  </form>
  </p>
  <br>
  <form id="outgoingMsg">
    <input type="text" placeholder="Enter Value A" name="toParent_valA">
	<input name="btn_toParent_valA" type="button" value="Send To Parent" />
	<br>
	<input type="text" placeholder="Enter Value B" name="toParent_valB">
	<input name="btn_toParent_valB" type="button" value="Send To Iframe 2" />
  </form>
  
  
  <script>
	var incomingMsg = document.getElementById('incomingMsg');
	var outgoingMsg = document.getElementById('outgoingMsg');
	var val;
	let sourceOrigin = '*';
	// check for browser support
	if ( window.addEventListener ) {
		// message handler
		window.addEventListener('message', function(e) {
			// check message origin
			if ( e.data['task'] ) {
				var task = e.data['task']; // task received in postMessage
				var msg; // for postMessage reply to e.source 
				
				switch ( task ) { // postMessage tasks
					
					// send value of entry in text box (validate first)
					case 'val' :
						//var re = /[^-a-zA-Z!,'?\s]/g; // to filter out unwanted characters
						//var fld = document.forms['iframeDemoForm'].elements['greeting'];
						//var val = fld.value.replace(re, '');
						val = e.data['val'];
						incomingMsg.elements.display.value = val;
						msg = {'task': 'response', 'val': Date()};
						e.source.postMessage(msg , sourceOrigin );
						break;
									
					//default:
				}
			}
			else{
						val = e.data;
						incomingMsg.elements.display.value = val;
						msg = Date();
						e.source.postMessage(msg , sourceOrigin );
				
			}
		}, false);
		
		window.addEventListener('load', function() {
			
			outgoingMsg.elements.btn_toParent_valA.onclick = function() {
				val = outgoingMsg.elements.toParent_valA.value;
				parent.postMessage( {'task': 'val', 'val':val}, sourceOrigin );
			}

			outgoingMsg.elements.btn_toParent_valB.onclick = function() {
				val = outgoingMsg.elements.toParent_valB.value;
				parent.postMessage( {'task': 'toIframe', 'val':val}, sourceOrigin );
			}							
				
		},false);
	}
	

  </script>

</body>
</html>